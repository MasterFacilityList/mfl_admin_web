<div class="content-header">
   <div class="action-container content-header-extra">
        <a tooltip="back" tooltip-placement="bottom" class="action-btn action-btn-primary action-btn-md" ui-sref="facilities_approve" ui-sref-opts="{reload:true}"><i class="fa fa-arrow-left"></i></a>
   </div>
   <h2 class="content-title">
       <span class="main-title"><i class="fa fa-check"></i> Approve Facility</span>
   </h2>
</div>
<div class="col-xs-12 margin-t-20">
    <div class="col-xs-12 content-card">
        <h4 class="fw-400"><a ui-sref="facilities.facility_edit">{{facility.code}} | {{facility.name | uppercase}}</a></h4>
        <div class="row">
            <div class="col-xs-12 margin-b-10 fs-16">
                <span>Facility Type: <strong>{{facility.facility_type_name}}</strong></span>
            </div>
            <div class="col-sm-6">
                <span>Regulation Status:
                    <span class="label label-warning" style="font-size: 13px">
                        {{facility.regulatory_status_name}}
                    </span>
                </span>
            </div>
            <div class="col-sm-6"><span class="pull-right">Operation Status: <span class="fs-14 label label-primary" style="font-size: 13px">{{facility.operation_status_name | titlecase}}</span></span></div>
       </div>
    </div>
    <button class="login-btn login-btn-primary" ng-click="viewFacility = !viewFacility">
        &nbsp;View {{viewFacility ? 'Less' : 'More'}} Facility Details <i class="fa {{viewFacility ? 'fa-chevron-up' : 'fa-chevron-down'}}"></i>
    </button>
    <div class="row" content-slide-in="viewFacility" slide-show-duration="1000">
        <div class="col-xs-12">
            <ul class="nav nav-tabs col-xs-12 margin-t-20">
                <li ui-sref-active="active">
                    <a ui-sref=".basic">
                        <span class="fw-900 ">
                            <i class="fa fa-building-o"></i> Facility Basic Details
                        </span>
                    </a>
                </li>
                <li ui-sref-active="active">
                    <a ui-sref=".services">
                        <span class="fw-900">
                            <i class="fa fa-exchange"></i> Facility Health Services
                        </span>
                    </a>
                </li>
                <li ui-sref-active="active">
                    <a ui-sref=".units">
                        <span class="fw-900 ">
                            <i class="fa fa-hospital-o"></i> Facility Departments
                        </span>
                    </a>
                </li>
            </ul>
            <div class="tab-content margin-t-20">
                <div class="pad-t-20" ui-view="form-view"></div>
            </div><!-- /tab-content -->
        </div>
    </div>
</div>
<div class="col-xs-12" ng-cloak>
    <div class="col-xs-12 content-card margin-t-20" ng-class="{'alert-success':facility.is_approved}">
        <div class="col-xs-12 margin-b-10" ng-if="!facility.is_approved">
            <h4 class>Approve newly created facility</h4>
            <form name="frm_approve">
                <div class="group margin-t-10">
                    <textarea name="comment" ng-model="facility_approval.comment" required rows="1">
                    </textarea>
                    <span class="highlight"></span>
                    <span class="bar"></span>
                    <label>
                        Comment for approval
                    </label>
                </div>
                <button class="login-btn login-btn-action" ng-click="approveFacility()">Approve Facility</button>
                <button class="login-btn login-btn-danger margin-l-5" ng-click="approveFacility(true)">Reject Facility</button>
            </form>
        </div>
        <div class="row" ng-if="facility.is_approved">
            <span class="col-xs-12 fs-16"><i class="fa fa-check"></i> Facility has already been approved</span>
            <div class="col-xs-12">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Done By</th>
                            <th>Done On</th>
                            <th>Comment</th>
                            <th>Rejected/Approved</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="fa in facility_approvals">
                            <td>{{fa.done_by}}</td>
                            <td>{{fa.created|date}}</td>
                            <td>{{fa.comment}}</td>
                            <td>{{fa.is_cancelled ? 'Rejected' : 'Approved'}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="col-xs-12 content-card margin-t-20" ng-class="{'alert-info':!facility.latest_update, 'detail-content' : facility.latest_update}">
        <div ng-if="facility.latest_update && facility.is_approved" class="content-card row">
            <h4 class="fs-18"><strong>Updated Facility Details</strong></h4>
            <div class="row">
                <div class="col-sm-6">
                    <p class="form-control-static fs-16">Updates made by: <span class="label label-warning">{{facility_update.created_by_name}}</span></p>
                </div>
                <div class="col-sm-6">
                    <p class="form-control-static text-right fs-16">Updates made on: <span class="label label-primary">{{facility_update.created | date}}</span></p>
                </div>
            </div>
            <hr>
            <table class="table table-hover table-stripped">
                <thead>
                    <tr>
                        <th>Field</th>
                        <th>Old value</th>
                        <th>New value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="change in facility_changes">
                        <td>{{change.human_field_name | titlecase}}</td>
                        <td>{{facility[change.field_name] | boolFilter}}</td>
                        <td>{{change.display_value}}</td>
                    </tr>
                </tbody>
            </table>
            <div class="margin-t-20 margin-b-10">
                <button ng-click="approveUpdate(true)" class="login-btn login-btn-success">Approve Updates</button>
                <button ng-click="approveUpdate(false)" class="login-btn login-btn-danger">Decline Updates</button>
            </div>
        </div>
        <div ng-if="!facility.latest_update" class="col-xs-12">
            <p class="lead margin-t-10 margin-b-10"><i class="fa fa-info-circle"></i> No facility updates pending approval</p>
        </div>
    </div>

    <div class="col-xs-12 content-card margin-t-20" ng-class="{'alert-info':facility_service_updates.length<1, 'detail-content' : facility_service_updates.length>0}">
        <div ng-if="facility_service_updates.length>0">
            <h4 class="fs-18"><strong>Updated Facility Services</strong></h4>
            <table class="table table-hover table-stripped">
                <thead>
                    <tr>
                        <th>Service</th>
                        <th>Option</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody ng-if="facility_service_updates.length>0">
                    <tr ng-repeat="fsu in facility_service_updates">
                        <td>{{fsu.service_name}}</td>
                        <td>{{fsu.option_display_value}}</td>
                        <td>
                            <button class="login-btn login-btn-success" ng-click="approveFacilityService(fsu,true)">
                                &nbsp;Approve
                            </button>
                            <button class="login-btn login-btn-danger" ng-click="approveFacilityService(fsu,false)">
                                &nbsp;Reject
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div ng-if="facility_service_updates.length<1" class="col-xs-12">
            <p class="lead margin-t-10 margin-b-10"><i class="fa fa-info-circle"></i> No facility service updates pending approval</p>
        </div>
    </div>
</div>
